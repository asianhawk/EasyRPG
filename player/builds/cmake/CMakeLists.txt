CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

PROJECT(EasyRPG_Player)

ADD_SUBDIRECTORY(${CMAKE_CURRENT_SOURCE_DIR}/../../../readers/builds/cmake ${CMAKE_CURRENT_SOURCE_DIR}/../../../readers/builds/cmake)

# FIND_PACKAGE(Boost COMPONENTS serialization REQUIRED)
FIND_PACKAGE(Freetype REQUIRED)
FIND_PACKAGE(JPEG REQUIRED)
FIND_PACKAGE(PNG REQUIRED)
FIND_PACKAGE(SDL REQUIRED)
FIND_PACKAGE(SDL_image REQUIRED)
FIND_PACKAGE(SDL_mixer REQUIRED)
FIND_PACKAGE(SDL_ttf REQUIRED)
FIND_PACKAGE(ZLIB REQUIRED)

# SET(USE_OPENAL 1)

ADD_DEFINITIONS(
	${PNG_DEFINITIONS}

	-D UNIX=1
	-D USE_SDL=1
	-D USE_PIXMAN_BITMAP=1

	-Wall -Werror # -Wextra
	-Wno-mismatched-tags
	-fno-exceptions -fno-rtti
)

IF(${USE_OPENAL})
	FIND_PACKAGE(OpenAL REQUIRED)
	INCLUDE_DIRECTORIES(${OPENAL_INCLUDE_DIR})
	ADD_DEFINITIONS(-D USE_OPENAL=1)
ENDIF()

INCLUDE(TestBigEndian)
TEST_BIG_ENDIAN(IS_BIG_ENDIAN)
IF(${IS_BIG_ENDIAN})
	ADD_DEFINITIONS(-D READER_BIG_ENDIAN=1)
ENDIF()

IF(${CMAKE_BUILD_TYPE} STREQUAL "Debug")
	ADD_DEFINITIONS(-D _DEBUG=1)
ENDIF()

INCLUDE_DIRECTORIES(
	# ${Boost_INCLUDE_DIRS}
	${FREETYPE_INCLUDE_DIRS}
	${JPEG_INCLUDE_DIR}
	${PNG_INCLUDE_DIR}
	${SDL_INCLUDE_DIR}
	${SDLIMAGE_INCLUDE_DIR}
	${SDLMIXER_INCLUDE_DIR}
	${SDLTTF_INCLUDE_DIR}
	${ZLIB_INCLUDE_DIRS}

	${CMAKE_CURRENT_SOURCE_DIR}/../../../readers/include
	/opt/local/include/pixman-1
	/usr/include/pixman-1
	/usr/local/include/pixman-1
)

AUX_SOURCE_DIRECTORY(${CMAKE_CURRENT_SOURCE_DIR}/../../src SRCS)

SET(EXECUTABLE_OUTPUT_PATH ${CMAKE_CURRENT_SOURCE_DIR}/../../bin/testgame)
ADD_EXECUTABLE(${PROJECT_NAME} MACOSX_BUNDLE ${SRCS})
IF(${APPLE})
	TARGET_LINK_LIBRARIES(${PROJECT_NAME} iconv)
ENDIF()
TARGET_LINK_LIBRARIES(${PROJECT_NAME}
	# ${Boost_LIBRARIES}
	${FREETYPE_LIBRARIES}
	${JPEG_LIBRARIES}
	${PNG_LIBRARIES}
	${SDL_LIBRARY}
	${SDLIMAGE_LIBRARY}
	${SDLMIXER_LIBRARY}
	${SDLTTF_LIBRARY}
	${ZLIB_LIBRARIES}

	EasyRPG_Reader

	expat
	pixman-1
)

IF(${USE_OPENAL})
	TARGET_LINK_LIBRARIES(${PROJECT_NAME}
		avformat avcodec avutil avdevice
		${OPENAL_LIBRARY}
	)
ENDIF()

ADD_DEPENDENCIES(${PROJECT_NAME} EasyRPG_Reader)
